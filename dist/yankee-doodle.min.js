var t,e;function n(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function r(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?n(Object(r),!0).forEach((function(e){f(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function o(t){return s(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||l(t)||a()}function i(t,e){return s(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,l=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){l=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(l)throw o}}return i}(t,e)||l(t,e)||a()}function a(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function l(t,e){if(t){if("string"==typeof t)return u(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(t,e):void 0}}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function s(t){if(Array.isArray(t))return t}function c(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function f(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var y=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),f(this,"reg",{get keys(){return new RegExp(",(?![^(]*[$)])|(?<=".concat(t.tokens.OPEN,")"))},get scopes(){var e=t.tokens,n=e.CLOSE,r=e.OPEN;return new RegExp("(?=[".concat(n,"]+)|(?=").concat(r,")"))},get flags(){var e=Object.values(t.tokens.FLAGS).map((function(t){return"\\".concat(t)})).join("|");return new RegExp("(?=".concat(e,")"))}}),f(this,"depth",0),f(this,"tree",[]),this.schemas=e,this.tokens=this.strip().split(this.reg.keys).map((function(t){return n.tokenise(t)}))}var e,n,a;return e=t,(n=[{key:"nodeify",value:function(){var e=i(this.tokens.shift(),2),n=e[0],a=e[1],l=o(n.split(t.tokens.DIV)),u=l[0],s=l.slice(1);return{shift:a,node:{children:[],filters:this.filterfy(s),options:r({},t.options),key:{value:u,path:u.split(t.tokens.SEG),name:u.split(t.tokens.SEG).pop()}}}}},{key:"filterfy",value:function(t){var e=this;return t.map((function(t){var n=i(t.split(/(?=\([\w$_,]*\)|$)/g),2),r=n[0],o=n[1],a=i(r.split(e.reg.flags),2),l=a[0],u=a[1],s=null==o?void 0:o.replace(/\(([\w$_,]*)\)/g,"$1").split(",").filter(Boolean);return{name:l,args:null!=s?s:[],flag:{value:null!=u?u:null,on:function(t,e){return u===t&&e()}}}}))}},{key:"tokenise",value:function(e){var n=o(e.split(this.reg.scopes)),r=n[0],i=n.slice(1),a=this.measure(i);return r===t.tokens.CLOSE?[null,a-1]:[r,a]}},{key:"next",value:function(t){var e=this.nodeify(t),n=e.node,r=e.shift,o=this.depth;for(this.depth+=r;r>0&&this.depth>o;)this.next(n.children);n.key&&t.push(n)}},{key:"measure",value:function(e){return+e.includes(t.tokens.OPEN)||-e.length||0}},{key:"strip",value:function(){return this.schema.trim().replace(/\s+/g,(function(e,n,r){return"\n"===e&&n[r+1]!==t.tokens.CLOSE?",":""}))}},{key:"parse",value:function(){for(;this.tokens.length;)this.next(this.tree);return this.tree}},{key:"schema",get:function(){return this.schemas.join(",")}}])&&c(e.prototype,n),a&&c(e,a),t}();f(y,"options",{nullable:!1,extract:!1,exec:null}),f(y,"tokens",{OPEN:":{",CLOSE:"}",DIV:"|",SEG:".",FLAGS:{MACRO:"!"}});var h=(e={Parser:y,tokens:y.tokens,flags:y.tokens.FLAGS}).Parser;function p(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return v(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){l=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(l)throw i}}}}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function d(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function b(t){return function(t){if(Array.isArray(t))return O(t)}(t)||m(t)||w(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function g(t,e){return S(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,l=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){l=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(l)throw o}}return i}(t,e)||w(t,e)||k()}function k(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function w(t,e){if(t){if("string"==typeof t)return O(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?O(t,e):void 0}}function O(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function S(t){if(Array.isArray(t))return t}var A,j=e.flags,E={as:function(t){var e=t.node,n=g(t.args,1)[0];e.key.name=n},nullable:function(t){var e=t.node,n=t.flag;e.options.nullable=!0,n.on(j.MACRO,(function(){var t,n=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=w(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){l=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(l)throw i}}}}(e.children);try{for(n.s();!(t=n.n()).done;){t.value.options.nullable=!0}}catch(t){n.e(t)}finally{n.f()}}))},extract:function(t){t.node.options.extract=!0},exec:function(t){var e,n,r=t.node,o=t.data,i=S(n=t.args)||m(n)||w(n)||k(),a=i[0],l=i.slice(1),u=null!==(e=o[a])&&void 0!==e?e:function(){return null};r.options.exec=function(t){return u.apply(void 0,[t].concat(b(l)))}}},x={invalidType:function(){return new Error("All schemas must be strings")},filterNotFound:function(t){return new Error('Filter "'.concat(t,'" could not be found'))}};var P=(A={validate:function(t){var e=t.findIndex((function(t){return"string"!=typeof t}));if(e>=0)throw x.invalidType(t[e]);return t},errors:x}).errors,I=Object.assign,C={Serialiser:function(){function t(e,n){var r,o,i;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),i={},(o="result")in(r=this)?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i,this.data=e,this.ast=n}var e,n,r;return e=t,(n=[{key:"yank",value:function(t,e,n){this.filter({ast:this.ast,node:t,data:e,parent:n});var r=this.get(e,t.key.path,t.options),o=this.set.bind(this,t,n);if(t.children.length){if(r||t.options.nullable){var i=this.dig(t,r);t.options.extract?I(n,i):o(i)}}else o(r)}},{key:"dig",value:function(t,e){var n={},r=t.children.every((function(t){return!t.options.nullable}));if(!e&&r)return null;var o,i=p(t.children);try{for(i.s();!(o=i.n()).done;){var a=o.value;this.yank(a,e,n)}}catch(t){i.e(t)}finally{i.f()}return n}},{key:"filter",value:function(t){var e,n=p(t.node.filters);try{for(n.s();!(e=n.n()).done;){var r=e.value,o=r.name,i=r.flag,a=r.args,l=E[o],u=I(t,{flag:i,args:a});if(!l)throw P.filterNotFound(o);l(u)}}catch(t){n.e(t)}finally{n.f()}}},{key:"get",value:function(t,e,n){var r=e.reduce((function(t,e){return null==t?void 0:t[e]}),t),o=n.exec?n.exec(r):r;return n.nullable?null!=o?o:null:o}},{key:"set",value:function(t,e,n){e[t.key.name]=n}},{key:"serialise",value:function(){var t,e=p(this.ast);try{for(e.s();!(t=e.n()).done;){var n=t.value;this.yank(n,this.data,this.result)}}catch(t){e.e(t)}finally{e.f()}return this.result}}])&&d(e.prototype,n),r&&d(e,r),t}()}.Serialiser,T=A.validate;t=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var o=T(n.flat()),i=new h(o),a=new C(t,i.parse());return a.serialise()},module.exports=t;
//# sourceMappingURL=yankee-doodle.min.js.map
