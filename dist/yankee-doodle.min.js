var t,n;function e(t){return l(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||a(t)||o()}function r(t,n){return l(t)||function(t,n){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==e)return;var r,o,a=[],i=!0,l=!1;try{for(e=e.call(t);!(i=(r=e.next()).done)&&(a.push(r.value),!n||a.length!==n);i=!0);}catch(t){l=!0,o=t}finally{try{i||null==e.return||e.return()}finally{if(l)throw o}}return a}(t,n)||a(t,n)||o()}function o(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function a(t,n){if(t){if("string"==typeof t)return i(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?i(t,n):void 0}}function i(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function l(t){if(Array.isArray(t))return t}function u(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function s(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}var f=Object.assign,c=function(){function t(n){var e=this;!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),s(this,"reg",{get keys(){return new RegExp(",(?![^(]*[$)])|(?<=".concat(t.tokens.OPEN,")"))},get scopes(){var n=t.tokens,e=n.CLOSE,r=n.OPEN;return new RegExp("(?=[".concat(e,"]+)|(?=").concat(r,")"))},get flags(){var n=Object.values(t.tokens.FLAGS).map((function(t){return"\\".concat(t)})).join("|");return new RegExp("(?=".concat(n,")"))}}),s(this,"depth",0),s(this,"tree",[]),this.tokens=this.strip(n).split(this.reg.keys).map((function(t){return e.tokenise(t)}))}var n,o,a;return n=t,(o=[{key:"nodeify",value:function(){var n=r(this.tokens.shift(),2),o=n[0],a=n[1],i=e(o.split(t.tokens.DIV)),l=i[0],u=i.slice(1);return{shift:a,node:{filters:this.filterfy(u),children:[],options:f({},t.options),key:{value:l,path:l.split(t.tokens.SEG),name:l.split(t.tokens.SEG).pop()}}}}},{key:"filterfy",value:function(t){var n=this;return t.map((function(t){var e=r(t.split(/(?=\([\w$_,]*\)|$)/g),2),o=e[0],a=e[1],i=r(o.split(n.reg.flags),2),l=i[0],u=i[1],s=null==a?void 0:a.replace(/\(([\w$_,]*)\)/g,"$1").split(",").filter(Boolean);return{name:l,args:null!=s?s:[],flag:{value:null!=u?u:null,on:function(t,n){return u===t&&n()}}}}))}},{key:"tokenise",value:function(n){var r=e(n.split(this.reg.scopes)),o=r[0],a=r.slice(1),i=this.measure(a);return o===t.tokens.CLOSE?[null,i-1]:[o,i]}},{key:"next",value:function(t){var n=this.nodeify(t),e=n.node,r=n.shift,o=this.depth;for(this.depth+=r;r>0&&this.depth>o;)this.next(e.children);e.key&&t.push(e)}},{key:"measure",value:function(n){return+n.includes(t.tokens.OPEN)||-n.length||0}},{key:"strip",value:function(n){var e=function(n,e,r){return"\n"===n&&e[r+1]!==t.tokens.CLOSE};return n.trim().replace(/\s+/g,(function(){return e.apply(void 0,arguments)?",":""}))}},{key:"parse",value:function(){for(;this.tokens.length;)this.next(this.tree);return this.tree}}])&&u(n.prototype,o),a&&u(n,a),t}();s(c,"options",{nullable:!1,extract:!1,exec:null}),s(c,"tokens",{OPEN:":{",CLOSE:"}",DIV:"|",SEG:".",FLAGS:{MACRO:"!"}});var y=(n={Parser:c,tokens:c.tokens,flags:c.tokens.FLAGS}).Parser;function h(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,n){if(!t)return;if("string"==typeof t)return v(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return v(t,n)}(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return i=t.done,t},e:function(t){l=!0,a=t},f:function(){try{i||null==e.return||e.return()}finally{if(l)throw a}}}}function v(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function p(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function d(t){return function(t){if(Array.isArray(t))return w(t)}(t)||b(t)||k(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function m(t,n){return S(t)||function(t,n){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==e)return;var r,o,a=[],i=!0,l=!1;try{for(e=e.call(t);!(i=(r=e.next()).done)&&(a.push(r.value),!n||a.length!==n);i=!0);}catch(t){l=!0,o=t}finally{try{i||null==e.return||e.return()}finally{if(l)throw o}}return a}(t,n)||k(t,n)||g()}function g(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function k(t,n){if(t){if("string"==typeof t)return w(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?w(t,n):void 0}}function w(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function S(t){if(Array.isArray(t))return t}var A=n.flags,O={as:function(t){var n=t.node,e=m(t.args,1)[0];n.key.name=e},nullable:function(t){var n=t.node,e=t.flag;n.options.nullable=!0,e.on(A.MACRO,(function(){var t,e=function(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=k(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return i=t.done,t},e:function(t){l=!0,a=t},f:function(){try{i||null==e.return||e.return()}finally{if(l)throw a}}}}(n.children);try{for(e.s();!(t=e.n()).done;){t.value.options.nullable=!0}}catch(t){e.e(t)}finally{e.f()}}))},extract:function(t){t.node.options.extract=!0},exec:function(t){var n,e,r=t.node,o=t.data,a=S(e=t.args)||b(e)||k(e)||g(),i=a[0],l=a.slice(1),u=null!==(n=o[i])&&void 0!==n?n:function(){return null};r.options.exec=function(t){return u.apply(void 0,[t].concat(d(l)))}}},E=Object.assign,j={Serialiser:function(){function t(n,e){var r,o,a;!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),a={},(o="result")in(r=this)?Object.defineProperty(r,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[o]=a,this.data=n,this.ast=e}var n,e,r;return n=t,(e=[{key:"yank",value:function(t,n,e){this.filter({ast:this.ast,node:t,data:n,parent:e});var r=this.get(n,t.key.path,t.options),o=this.set.bind(this,t,e);if(t.children.length){if(r||t.options.nullable){var a=this.dig(t,r);t.options.extract?E(e,a):o(a)}}else o(r)}},{key:"dig",value:function(t,n){var e={},r=t.children.every((function(t){return!t.options.nullable}));if(!n&&r)return null;var o,a=h(t.children);try{for(a.s();!(o=a.n()).done;){var i=o.value;this.yank(i,n,e)}}catch(t){a.e(t)}finally{a.f()}return e}},{key:"filter",value:function(t){var n,e=h(t.node.filters);try{for(e.s();!(n=e.n()).done;){var r=n.value,o=r.name,a=r.flag,i=r.args,l=O[o];l(E(t,{flag:a,args:i}))}}catch(t){e.e(t)}finally{e.f()}}},{key:"get",value:function(t,n,e){var r=n.reduce((function(t,n){return null==t?void 0:t[n]}),t),o=e.exec?e.exec(r):r;return e.nullable?null!=o?o:null:o}},{key:"set",value:function(t,n,e){n[t.key.name]=e}},{key:"serialise",value:function(){var t,n=h(this.ast);try{for(n.s();!(t=n.n()).done;){var e=t.value;this.yank(e,this.data,this.result)}}catch(t){n.e(t)}finally{n.f()}return this.result}}])&&p(n.prototype,e),r&&p(n,r),t}()}.Serialiser;var x={validate:function(t){if(t.some((function(t){return"string"!=typeof t})))throw new Error("All schemas must be strings")}}.validate;t=function(t){for(var n=arguments.length,e=new Array(n>1?n-1:0),r=1;r<n;r++)e[r-1]=arguments[r];if(!e.length)return t;x(e);var o=e.flat().join(","),a=new y(o),i=new j(t,a.parse());return i.serialise()},module.exports=t;
//# sourceMappingURL=yankee-doodle.min.js.map
